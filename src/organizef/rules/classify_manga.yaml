rules:
  # 创建分类目录
  - name: "创建漫画分类目录"
    locations: ${locations}
    filters:
      - python: |
          import os
          from pathlib import Path

          # 需要创建的目录
          categories = ["1. 同人志", "2. 商业志", "3. 单行本", "4. 同人动画", "5. 同人CG", "6. 画集"]

          for category in categories:
              category_path = Path(location) / category
              if not category_path.exists():
                  category_path.mkdir(parents=True, exist_ok=True)
                  print(f"创建目录: {category}")

          # 只执行一次创建目录，返回False不处理文件
          return False
    actions:
      - shell: 'echo "目录创建完成"'

  # 分类漫画压缩包 - 同人志
  - name: "分类漫画压缩包 - 同人志"
    locations: ${locations}
    filters:
      - extension:
          - zip
          - rar
          - "7z"
          - cbz
          - cbr
      - python: |
          # 同人志关键词
          keywords = ["doujin", "doujinshi", "同人", "同人志", "同人本", "同人作品", "同人小说"]

          filename = path.name.lower()

          # 检查是否包含同人志关键词
          for keyword in keywords:
              if keyword.lower() in filename:
                  return True

          return False
    actions:
      - move: "{location}/1. 同人志/{path.name}"

  # 分类漫画压缩包 - 商业志
  - name: "分类漫画压缩包 - 商业志"
    locations: ${locations}
    filters:
      - extension:
          - zip
          - rar
          - "7z"
          - cbz
          - cbr
      - python: |
          # 商业志关键词
          keywords = ["magazine", "mag", "杂志", "商业志", "月刊", "週刊", "周刊", "comic", "コミック"]

          filename = path.name.lower()

          # 检查是否包含商业志关键词
          for keyword in keywords:
              if keyword.lower() in filename:
                  return True

          return False
    actions:
      - move: "{location}/2. 商业志/{path.name}"

  # 分类漫画压缩包 - 单行本
  - name: "分类漫画压缩包 - 单行本"
    locations: ${locations}
    filters:
      - extension:
          - zip
          - rar
          - "7z"
          - cbz
          - cbr
      - python: |
          # 单行本关键词
          keywords = ["tankobon", "单行本", "単行本", "volume", "vol", "巻", "第"]

          filename = path.name.lower()

          # 检查是否包含单行本关键词
          for keyword in keywords:
              if keyword.lower() in filename:
                  return True

          return False
    actions:
      - move: "{location}/3. 单行本/{path.name}"

  # 分类漫画压缩包 - 同人动画
  - name: "分类漫画压缩包 - 同人动画"
    locations: ${locations}
    filters:
      - extension:
          - zip
          - rar
          - "7z"
          - cbz
          - cbr
      - python: |
          # 同人动画关键词
          keywords = ["animation", "anime", "动画", "同人动画", "ova", "同人ova", "動畫"]

          filename = path.name.lower()

          # 检查是否包含同人动画关键词
          for keyword in keywords:
              if keyword.lower() in filename:
                  return True

          return False
    actions:
      - move: "{location}/4. 同人动画/{path.name}"

  # 分类漫画压缩包 - 同人CG
  - name: "分类漫画压缩包 - 同人CG"
    locations: ${locations}
    filters:
      - extension:
          - zip
          - rar
          - "7z"
          - cbz
          - cbr
      - python: |
          # 同人CG关键词
          keywords = ["cg", "computer graphics", "同人cg", "电脑绘图", "数位绘图", "digital art"]

          filename = path.name.lower()

          # 检查是否包含同人CG关键词
          for keyword in keywords:
              if keyword.lower() in filename:
                  return True

          return False
    actions:
      - move: "{location}/5. 同人CG/{path.name}"

  # 分类漫画压缩包 - 画集
  - name: "分类漫画压缩包 - 画集"
    locations: ${locations}
    filters:
      - extension:
          - zip
          - rar
          - "7z"
          - cbz
          - cbr
      - python: |
          # 画集关键词
          keywords = ["artbook", "pixiv", "fanbox", "fantia", "patron", "illustration", "画集", "イラスト", "插画集", "art collection"]

          filename = path.name.lower()

          # 检查是否包含画集关键词
          for keyword in keywords:
              if keyword.lower() in filename:
                  return True

          return False
    actions:
      - move: "{location}/6. 画集/{path.name}"

