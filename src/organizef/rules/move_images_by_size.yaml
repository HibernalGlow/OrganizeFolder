rules:
  - name: "移动符合条件的图片到 [organize_images] 文件夹"
    locations: ${locations}
    subfolders: true
    filters:
      - extension: ${image_extensions}
      - python: |
          from PIL import Image
          import pillow_avif
          import pillow_jxl

          def check_ranges(value, ranges):
              """快速检查尺寸是否在范围内"""
              if not ranges:
                  return False
              for r in ranges:
                  if isinstance(r, (int, float)) and value <= r:
                      return True
              return False

          # 检查是否在目标文件夹中
          if '[organize_images]' in str(path):
              return False

          try:
              with Image.open(path) as img:
                  width, height = img.size

                  # 获取参数并检查
                  max_w = ${max_width}
                  max_h = ${max_height}

                  if not max_w and not max_h:
                      return False

                  # 快速检查条件
                  w_ok = check_ranges(width, max_w) if max_w else True
                  h_ok = check_ranges(height, max_h) if max_h else True

                  return w_ok and h_ok

          except:
              return False
    actions:
      - move: "{location}/[organize_images]/{path.relative_to(location)}"